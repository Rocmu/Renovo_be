import"./modulepreload-polyfill-B5Qt9EMX.js";import"./main-BZnlAnNM.js";import{f as p}from"./fetch-DBomrZ5j.js";function v(E){const d=document.createElement("div");d.className="toast",d.textContent=E,document.body.appendChild(d),setTimeout(()=>{d.remove()},3e3)}let _=null;document.addEventListener("DOMContentLoaded",function(){const E=document.getElementById("calendarView"),d=new FullCalendar.Calendar(E,{initialView:"dayGridMonth",timeZone:"local",locale:"fi",firstDay:1,headerToolbar:{left:"prev",center:"title",right:"next"},titleFormat:{year:"numeric",month:"long"},events:async function(o,t,e){try{const a=localStorage.getItem("user_id"),s=localStorage.getItem("token"),[l,r,i,u]=await Promise.all([p(`http://localhost:3000/api/shifts/user/${a}`,{method:"GET",headers:{Authorization:`Bearer ${s}`}}),p(`http://localhost:3000/api/exercise/user/${a}`,{method:"GET",headers:{Authorization:`Bearer ${s}`}}),p(`http://localhost:3000/api/sickness/user/${a}`,{method:"GET",headers:{Authorization:`Bearer ${s}`}}),p(`http://localhost:3000/api/others/user/${a}`,{method:"GET",headers:{Authorization:`Bearer ${s}`}})]),c=[...l.map(n=>({id:`shift_${n.shift_id||n.id}`,title:"Ty√∂vuoro",start:`${n.start_date.slice(0,10)}T${n.start_time.slice(0,10)}`,end:`${n.end_date.slice(0,10)}T${n.end_time.slice(0,10)}`,backgroundColor:"#0044cc",textColor:"white",className:["shift-event"],extendedProps:{type:"shift",_id:n.shift_id||n.id}})),...r.map(n=>({id:`ex_${n.Exercise_id}`,title:n.exercise_type,start:n.exercise_date.slice(0,10),className:["exercise-event"],extendedProps:{type:"exercise",level:n.level,notes:n.notes}})),...i.map(n=>({id:`sick_${n.Sickness_id}`,title:n.description,start:n.sickness_date.slice(0,10),className:["sickness-event"],extendedProps:{type:"sickness",impact:n.impact,notes:n.notes}})),...u.map(n=>({id:`other_${n.Others_id}`,title:n.description,start:n.others_date.slice(0,10),className:["others-event"],extendedProps:{type:"others",intensity:n.intensity,notes:n.notes}}))];console.log(c),t(c)}catch(a){console.error("Error fetching events:",a),e(a)}},eventMouseEnter:function(o){o.el.style.cursor="pointer",o.el.title="Klikkaa muokataksesi"},eventClick:function(o){const t=o.event,e=t.extendedProps;if(e.type==="shift")document.getElementById("editShiftModal").style.display="block",document.getElementById("editDate").value=t.startStr.split("T")[0],document.getElementById("editStartTime").value=t.startStr.split("T")[1].slice(0,5),document.getElementById("editEndTime").value=t.endStr.split("T")[1].slice(0,5),document.getElementById("eventId").value=e._id;else{const a=document.getElementById("editModal"),s=a.querySelector("#editEventForm"),l={exercise:"Muokkaa liikuntasuoritusta",sickness:"Muokkaa sairastumista",others:"Muokkaa muuta tapahtumaa"};switch(a.querySelector("h2").textContent=l[e.type]||"Muokkaa tapahtumaa",s.start_time.closest("label").style.display="none",s.end_time.closest("label").style.display="none",s.level.closest("label").style.display="none",e.type){case"exercise":s.start_time.closest("label").style.display="block",s.end_time.closest("label").style.display="block",s.level.closest("label").style.display="block";break;case"sickness":case"others":s.level.closest("label").style.display="block";break}s.event_id.value=t.id,s.event_type.value=e.type,s.date.value=t.startStr.split("T")[0],s.description.value=t.title,t.startStr.includes("T")&&(s.start_time.value=t.startStr.split("T")[1].slice(0,5)),t.endStr&&t.endStr.includes("T")&&(s.end_time.value=t.endStr.split("T")[1].slice(0,5)),s.level.value=e.level||e.impact||e.intensity||"",s.notes.value=e.notes||"",a.style.display="block"}},eventContent:function(o){const t={exercise:"üèÉ‚Äç‚ôÇÔ∏è",sickness:"ü§í",others:"üìå"},e=o.event.extendedProps.type;return e==="shift"?{html:`<div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${o.event.title}</div>`}:{html:`<div title="${o.event.title}">${t[e]||"‚ùî"}</div>`}}});_=d,d.render(),d.refetchEvents();const B=document.getElementById("shiftModal"),I=document.querySelector(".form-shift-table");document.getElementById("openShiftModal");function M(){const o=_.getDate(),t=o.getFullYear(),e=o.getMonth(),a=new Date(t,e+1,0).getDate();I.innerHTML='<div class="form-shift-header"><span>Vuoron alkamis aika:</span><span>Vuoron p√§√§ttymis aika:</span></div>';for(let s=1;s<=a;s++){const r=new Date(t,e,s).toLocaleDateString("fi-FI",{weekday:"short"}),i=document.createElement("div");i.className="form-row",i.innerHTML=`
            <label>${r} ${s}.${e+1}.</label>
            <input type="time" name="start_${s}">
            <span>-</span>
            <input type="time" name="end_${s}">
        `,I.appendChild(i)}}document.getElementById("openShiftModal").addEventListener("click",()=>{M(),B.style.display="block"}),document.getElementById("openExerciseModal").addEventListener("click",()=>{document.getElementById("exerciseModal").style.display="block"}),document.getElementById("openSicknessModal").addEventListener("click",()=>{document.getElementById("sicknessModal").style.display="block"}),document.getElementById("openOthersModal").addEventListener("click",()=>{document.getElementById("othersModal").style.display="block"}),document.getElementById("shiftForm").addEventListener("submit",async function(o){o.preventDefault();const t=_.getDate(),e=t.getFullYear(),a=t.getMonth(),s=new Date(e,a+1,0).getDate(),l=localStorage.getItem("user_id"),r=localStorage.getItem("token");let i=0;const u=[];for(let c=1;c<=s;c++){const n=document.querySelector(`[name="start_${c}"]`),m=document.querySelector(`[name="end_${c}"]`);if(n&&m&&n.value&&m.value)try{const h=n.value,g=m.value,y=new Date(e,a,c);let f=new Date(e,a,c);const[$,S]=h.split(":").map(Number),[b,T]=g.split(":").map(Number);y.setHours($,S),f.setHours(b,T);const w=f<y;w&&f.setDate(f.getDate()+1);const L=y.toISOString().split("T")[0],C=f.toISOString().split("T")[0],F={user_id:parseInt(l),start_date:L,start_time:`${String($).padStart(2,"0")}:${String(S).padStart(2,"0")}:00`,end_date:C,end_time:`${String(b).padStart(2,"0")}:${String(T).padStart(2,"0")}:00`,is_night_shift:w},D=await fetch("http://localhost:3000/api/shifts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(F)});if(!D.ok)throw new Error(`HTTP error! status: ${D.status}`);i++}catch(h){console.error(`Tallennusvirhe p√§iv√§lle ${c}.${a+1}:`,h),u.push(`P√§iv√§ ${c}.${a+1}. ei tallentunut: ${h.message}`)}}u.length>0?v(`Virheit√§ tallennuksessa: ${u.join(", ")}`):i>0?(v(`Tallennettu ${i} ty√∂vuoro(a)`),d.refetchEvents()):v("Ei tallennettuja ty√∂vuoroja"),closeModal("shiftModal")}),document.getElementById("exerciseForm").addEventListener("submit",async function(o){o.preventDefault(),await k("exerciseForm","exercise","http://localhost:3000/api/exercise")}),document.getElementById("sicknessForm").addEventListener("submit",async function(o){o.preventDefault(),await k("sicknessForm","sickness","http://localhost:3000/api/sickness")}),document.getElementById("othersForm").addEventListener("submit",async function(o){o.preventDefault(),await k("othersForm","others","http://localhost:3000/api/others")});async function k(o,t,e){const a=document.getElementById(o),s=new FormData(a),l={};s.forEach((r,i)=>{l[i]=r}),l.user_id=localStorage.getItem("user_id");try{const i={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(l)},u=await p(e,i);if(u.error)throw new Error(u.error);alert(`${t.charAt(0).toUpperCase()+t.slice(1)} tallennettu!`),closeModal(`${t}Modal`),d.refetchEvents()}catch(r){console.error(`Error saving ${t}:`,r),alert(`Virhe tallennettaessa ${t}: ${r.message}`)}}document.getElementById("editShiftForm").addEventListener("submit",async function(o){o.preventDefault();const t=document.getElementById("eventId").value,e=document.getElementById("editDate").value,a=document.getElementById("editStartTime").value,s=document.getElementById("editEndTime").value;try{const l=localStorage.getItem("token"),r=localStorage.getItem("user_id"),i=new Date(`${e}T${a}`),c=new Date(`${e}T${s}`)<i;let n=e;if(c){const y=new Date(i);y.setDate(y.getDate()+1),n=y.toISOString().split("T")[0]}const m={user_id:r,start_date:e,start_time:a+":00",end_date:n,end_time:s+":00",is_night_shift:c},h=await p(`http://localhost:3000/api/shifts/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(m)});if(h.error)throw new Error(h.error);const g=d.getEventById(`shift_${t}`);g&&g.setDates(`${m.start_date}T${m.start_time}`,`${m.end_date}T${m.end_time}`),v("Ty√∂vuoro p√§ivitetty!"),closeModal("editShiftModal")}catch(l){console.error("Virhe ty√∂vuoron p√§ivityksess√§:",l),v("Virhe p√§ivitett√§ess√§ ty√∂vuoroa: "+l.message)}}),document.getElementById("deleteShiftButton").addEventListener("click",async function(){if(!confirm("Haluatko varmasti poistaa t√§m√§n ty√∂vuoron?"))return;const o=document.getElementById("eventId").value;console.log("what"+o);try{const t=localStorage.getItem("token"),e=await p(`http://localhost:3000/api/shifts/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(e.error)throw new Error(e.error);const a=d.getEventById(`shift_${o}`);a&&a.remove(),v("Ty√∂vuoro poistettu!"),closeModal("editShiftModal")}catch(t){console.error("Virhe ty√∂vuoron poistossa:",t),v("Virhe poistettaessa ty√∂vuoroa: "+t.message)}}),document.getElementById("editEventForm").addEventListener("submit",async function(o){o.preventDefault();const t=localStorage.getItem("user_id"),e=o.target,a=e.event_id.value,s=e.event_type.value;console.log(s);const l=a.split("_")[1];if(!l){alert("Tapahtuman ID on puutteellinen!");return}const r={exercise:`http://localhost:3000/api/exercise/${l}`,sickness:`http://localhost:3000/api/sickness/${l}`,others:`http://localhost:3000/api/others/${l}`};let i={};s==="exercise"?(e.start_time.closest("label").style.display="block",e.end_time.closest("label").style.display="block",e.level.closest("label").style.display="block",i={user_id:t,[`${s}_date`]:e.date.value,exercise_type:e.description.value,start_time:e.start_time.value,end_time:e.end_time.value,level:e.level.value,notes:e.notes.value},console.log(i)):s==="sickness"?(e.start_time.closest("label").style.display="none",e.end_time.closest("label").style.display="none",e.level.closest("label").style.display="block",i={user_id:t,[`${s}_date`]:e.date.value,description:e.description.value,impact:e.level.value,notes:e.notes.value},console.log(i)):s==="others"&&(e.start_time.closest("label").style.display="none",e.end_time.closest("label").style.display="none",e.level.closest("label").style.display="block",i={user_id:t,[`${s}_date`]:e.date.value,description:e.description.value,intensity:e.level.value,notes:e.notes.value},console.log(i));try{const c={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(i)},n=await p(r[s],c);if(n.error)throw new Error(n.error);alert("Tapahtuma p√§ivitetty!"),closeModal("editModal"),d.refetchEvents()}catch(u){alert("Virhe p√§ivitett√§ess√§ tapahtumaa: "+u.message)}}),document.getElementById("deleteEventButton").addEventListener("click",async function(){const o=document.getElementById("editEventForm"),t=o.event_id.value,e=o.event_type.value,a=t.split("_")[1];if(!a){alert("Tapahtuman ID on puutteellinen!");return}const s={exercise:`http://localhost:3000/api/exercise/${a}`,sickness:`http://localhost:3000/api/sickness/${a}`,others:`http://localhost:3000/api/others/${a}`};if(confirm("Haluatko varmasti poistaa t√§m√§n tapahtuman?"))try{const r={method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},i=await p(s[e],r);if(i.error)throw new Error(i.error);alert("Tapahtuma poistettu!"),closeModal("editModal"),d.refetchEvents()}catch(l){alert("Virhe poistettaessa tapahtumaa: "+l.message)}});function x(o){o.preventDefault();const t=document.querySelector(".calendar-info"),e=document.querySelector("#event-instructions");t.style.display==="flex"?(t.style.animation="disappear 1s ease-out forwards",e.textContent="Lis√§tietoa tapahtumien tallennuksesta",setTimeout(()=>{t.style.display="none"},1e3)):(t.style.display="flex",t.style.animation="appear 1s ease-out forwards",e.textContent="Piilota lis√§tiedot",t.scrollIntoView({behavior:"smooth"}))}document.querySelector("#event-instructions").addEventListener("click",x),window.closeModal=function(o){document.getElementById(o).style.display="none"},window.onclick=function(o){o.target.classList.contains("calendar-modal")&&closeModal(o.target.id)}});
